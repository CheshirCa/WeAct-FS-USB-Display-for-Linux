# ğŸ”§ WeActCLI v2.0.1 - Text Clipping Fix

## Ğ§Ñ‚Ğ¾ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ / What's Fixed

### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° / Problem
Ğ’ĞµÑ€Ñ…Ğ½ÑÑ ÑÑ‚Ñ€Ğ¾ĞºĞ° Ñ‚ĞµĞºÑÑ‚Ğ° Ğ¾Ğ±Ñ€ĞµĞ·Ğ°Ğ»Ğ°ÑÑŒ ÑĞ²ĞµÑ€Ñ…Ñƒ:
- 8pt ÑˆÑ€Ğ¸Ñ„Ñ‚: Ğ½ĞµĞ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ¾Ğ±Ñ€ĞµĞ·Ğ°Ğ½
- 16pt ÑˆÑ€Ğ¸Ñ„Ñ‚: Ğ¾Ğ±Ñ€ĞµĞ·Ğ°Ğ½ Ğ½Ğ°Ğ¿Ğ¾Ğ»Ğ¾Ğ²Ğ¸Ğ½Ñƒ

The top line of text was clipped:
- 8pt font: slightly clipped
- 16pt font: half cut off

### ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ° / Root Cause

FreeType Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ ĞºĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ‚Ñƒ Y ĞºĞ°Ğº **baseline** (Ğ±Ğ°Ğ·Ğ¾Ğ²ÑƒÑ Ğ»Ğ¸Ğ½Ğ¸Ñ), Ğ° Ğ½Ğµ Ğ²ĞµÑ€Ñ… Ñ‚ĞµĞºÑÑ‚Ğ°.

```
Ğ¡Ğ¸Ğ¼Ğ²Ğ¾Ğ» "Ğ":
     ^
    /|\   â† Ğ’ĞµÑ€Ñ… Ğ±ÑƒĞºĞ²Ñ‹ (ascent)
   / | \
  /  |  \
 /   |   \
/____|____\ â† Baseline (Y=5)
```

ĞšĞ¾Ğ³Ğ´Ğ° Ğ¼Ñ‹ Ğ·Ğ°Ğ´Ğ°Ğ²Ğ°Ğ»Ğ¸ Y=5, baseline Ğ±Ñ‹Ğ» Ğ½Ğ° Y=5, Ğ° Ğ²ĞµÑ€Ñ…ÑƒÑˆĞºĞ° Ğ±ÑƒĞºĞ²Ñ‹ ÑƒÑ…Ğ¾Ğ´Ğ¸Ğ»Ğ° Ğ²Ğ²ĞµÑ€Ñ… Ğ¸ Ğ¾Ğ±Ñ€ĞµĞ·Ğ°Ğ»Ğ°ÑÑŒ.

FreeType uses Y coordinate as **baseline**, not top of text. When we set Y=5, the baseline was at Y=5, but the top of letters extended above and got clipped.

### Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ / Solution

ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ ÑĞ¼ĞµÑ‰Ğ°ĞµĞ¼ baseline Ğ²Ğ½Ğ¸Ğ· Ğ½Ğ° Ğ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ğ½Ñƒ ascent:

```c
// Ğ‘Ñ‹Ğ»Ğ¾ / Before:
int pen_y = y;

// Ğ¡Ñ‚Ğ°Ğ»Ğ¾ / After:
int ascent = ctx->face->size->metrics.ascender >> 6;
int pen_y = y + ascent;  // Ğ¡Ğ¼ĞµÑ‰Ğ°ĞµĞ¼ Ğ²Ğ½Ğ¸Ğ·
```

Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Y Ğ¾Ğ·Ğ½Ğ°Ñ‡Ğ°ĞµÑ‚ **Ğ²ĞµÑ€Ñ… Ñ‚ĞµĞºÑÑ‚Ğ°**, Ğ° Ğ½Ğµ baseline.

Now Y means **top of text**, not baseline.

## ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ / Update

### Ğ‘Ñ‹ÑÑ‚Ñ€Ğ°Ñ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° / Quick Install
```bash
# Ğ Ğ°ÑĞ¿Ğ°ĞºĞ¾Ğ²Ğ°Ñ‚ÑŒ v2.0.1
tar -xzf weactcli-linux-v2.0.1.tar.gz
cd weactcli-linux

# Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ
./install.sh

# Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾!
```

### ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ v2.0 / Update from v2.0
```bash
cd weactcli-linux
# Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ text_freetype.c
make clean && make
```

## Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ / Testing

```bash
# ĞœĞ°Ğ»ĞµĞ½ÑŒĞºĞ¸Ğ¹ ÑˆÑ€Ğ¸Ñ„Ñ‚ - Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ²Ğ¸Ğ´ĞµĞ½
weactcli -p /dev/ttyACM0 -z 8 "Test"

# Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ ÑˆÑ€Ğ¸Ñ„Ñ‚ - Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ²Ğ¸Ğ´ĞµĞ½
weactcli -p /dev/ttyACM0 -z 12 "Test"

# Ğ‘Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ ÑˆÑ€Ğ¸Ñ„Ñ‚ - Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ²Ğ¸Ğ´ĞµĞ½ (Ñ€Ğ°Ğ½ÑŒÑˆĞµ Ğ¾Ğ±Ñ€ĞµĞ·Ğ°Ğ»ÑÑ!)
weactcli -p /dev/ttyACM0 -z 16 "Test"

# ĞšĞ¸Ñ€Ğ¸Ğ»Ğ»Ğ¸Ñ†Ğ° Ğ±Ğ¾Ğ»ÑŒÑˆĞ°Ñ - Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ²Ğ¸Ğ´Ğ½Ğ°
weactcli -p /dev/ttyACM0 -z 16 "ĞŸĞ Ğ˜Ğ’Ğ•Ğ¢"
```

## Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸ / Technical Details

### Ğ˜Ğ·Ğ¼ĞµĞ½Ñ‘Ğ½Ğ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ / Modified Functions

**1. ft_text_draw()** - Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ¾Ñ‚Ñ€Ğ¸ÑĞ¾Ğ²ĞºĞ¸
```c
// Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ ÑĞ¼ĞµÑ‰ĞµĞ½Ğ¸Ğµ Ğ½Ğ° ascent
int ascent = ctx->face->size->metrics.ascender >> 6;
int pen_y = y + ascent;
```

**2. ft_text_get_height()** - Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ñ€ĞµĞ°Ğ»ÑŒĞ½ÑƒÑ Ğ²Ñ‹ÑĞ¾Ñ‚Ñƒ
```c
// Ğ‘Ñ‹Ğ»Ğ¾: return ctx->font_size;
// Ğ¡Ñ‚Ğ°Ğ»Ğ¾:
int ascent = ctx->face->size->metrics.ascender >> 6;
int descent = -(ctx->face->size->metrics.descender >> 6);
return ascent + descent;
```

**3. ft_text_draw_wrapped()** - Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ°Ñ Ğ²Ñ‹ÑĞ¾Ñ‚Ğ° ÑÑ‚Ñ€Ğ¾ĞºĞ¸
```c
// Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ ÑˆÑ€Ğ¸Ñ„Ñ‚Ğ°, Ğ° Ğ½Ğµ font_size + 2
int ascent = ctx->face->size->metrics.ascender >> 6;
int descent = -(ctx->face->size->metrics.descender >> 6);
int line_height = ascent + descent + 2;
```

### ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ FreeType / FreeType Metrics

```
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚   ascent    â”‚  â† Ğ’Ñ‹ÑĞ¾Ñ‚Ğ° Ğ½Ğ°Ğ´ baseline
                 â”‚             â”‚
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â† Baseline (Y)
                 â”‚   descent   â”‚  â† Ğ“Ğ»ÑƒĞ±Ğ¸Ğ½Ğ° Ğ¿Ğ¾Ğ´ baseline
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ²Ñ‹ÑĞ¾Ñ‚Ğ° = ascent + descent
```

### Ğ¤Ğ°Ğ¹Ğ»Ñ‹ / Files Changed
- `text_freetype.c` (3 Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ñ‹)

### Ğ¡Ğ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ / Compatibility
âœ… ĞŸĞ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ¾ ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ°  
âœ… Ğ’ÑĞµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‚ ĞºĞ°Ğº Ñ€Ğ°Ğ½ÑŒÑˆĞµ  
âœ… ĞŸÑ€Ğ¾ÑÑ‚Ğ¾ Ñ‚ĞµĞºÑÑ‚ Ñ‚ĞµĞ¿ĞµÑ€ÑŒ Ğ½Ğµ Ğ¾Ğ±Ñ€ĞµĞ·Ğ°ĞµÑ‚ÑÑ!

Fully backwards compatible  
All commands work as before  
Text just doesn't clip anymore!

## Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ / Comparison

### v2.0 (Ğ¡Ñ‚Ğ°Ñ€Ğ°Ñ / Old)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              â”‚  â† Ğ’ĞµÑ€Ñ… ÑĞºÑ€Ğ°Ğ½Ğ°
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â† Y=5
â”‚ Ñ€Ğ¸Ğ²ĞµÑ‚        â”‚  â† "ĞŸ" Ğ¾Ğ±Ñ€ĞµĞ·Ğ°Ğ½Ğ°!
â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### v2.0.1 (Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ / Fixed)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ĞŸÑ€Ğ¸Ğ²ĞµÑ‚       â”‚  â† Ğ’ÑÑ‘ Ğ²Ğ¸Ğ´Ğ½Ğ¾!
â”‚              â”‚
â”‚              â”‚
â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Ğ”Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¾Ğ² / For Developers

Ğ•ÑĞ»Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚Ğµ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºÑƒ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ:

```c
// Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ ft_text_draw Ñ‚ĞµĞ¿ĞµÑ€ÑŒ Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ Y ĞºĞ°Ğº Ğ²ĞµÑ€Ñ… Ñ‚ĞµĞºÑÑ‚Ğ°
ft_text_draw(ctx, 0, 0, "Text");  // Ğ¢ĞµĞºÑÑ‚ Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°ĞµÑ‚ÑÑ Ñ Y=0

// Ğ Ğ°Ğ½ÑŒÑˆĞµ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ±Ñ‹Ğ»Ğ¾:
// ft_text_draw(ctx, 0, ascent, "Text");
```

## Ğ‘Ğ»Ğ°Ğ³Ğ¾Ğ´Ğ°Ñ€Ğ½Ğ¾ÑÑ‚Ğ¸ / Credits

Ğ¡Ğ¿Ğ°ÑĞ¸Ğ±Ğ¾ Ğ·Ğ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾ Ğ±Ğ°Ğ³Ğµ!  
Thanks for reporting the bug!

Ğ¢ĞµĞ¿ĞµÑ€ÑŒ FreeType Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ñ‚Ğ°Ğº Ğ¶Ğµ, ĞºĞ°Ğº Ğ² Windows Ğ²ĞµÑ€ÑĞ¸Ğ¸.  
Now FreeType works the same as in Windows version.

---

**Version:** 2.0.1  
**Fixed:** Text clipping at top  
**Status:** âœ… READY  
**Requires:** Same as v2.0 (libfreetype6-dev)
